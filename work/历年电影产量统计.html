<!DOCTYPE html>
<html style="height: 100%">
<head>
    <meta charset="UTF-8">
    <title>历年电影产量统计图</title>
    <!-- 引入 ECharts 和 d3.js -->
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body style="height: 100%; margin: 0">
    <!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
    <div id="main" style="width: 100%; height: 100%;"></div>
    <script>
        // 基于准备好的 DOM，初始化 ECharts 实例
        var myChart = echarts.init(document.getElementById('main'));

        // 使用 d3.js 读取 CSV 文件
        d3.csv('./movies-1.csv').then(function(data) {
            // 检查数据是否读取正确
            console.log(data);

            // 创建一个对象来存储每年的电影产量
            var yearCounts = {};

            // 遍历 CSV 数据，统计每年电影产量
            data.forEach(function(d) {
                var year = parseInt(d.YEAR);
                if (year && year !== 0 && year <= 2018) {
                    if (yearCounts[year]) {
                        yearCounts[year]++;
                    } else {
                        yearCounts[year] = 1;
                    }
                }
            });

            // 将年份数据转换为数组，并按年份升序排列
            var sortedYears = Object.entries(yearCounts).sort((a, b) => a[0] - b[0]);

            // 分离年份和对应的产量
            var years = sortedYears.map(item => parseInt(item[0]));
            var counts = sortedYears.map(item => item[1]);

            // 指定图表的配置项和数据
            var option = {
                title: {
                    text: '历年电影产量统计图',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: function (params) {
                        return params[0].name + ' : ' + params[0].value;
                    }
                },
                xAxis: {
                    type: 'category',
                    name: '年份',
                    data: years
                },
                yAxis: {
                    type: 'value',
                    name: '产量'
                },
                series: [
                    {
                        name: '电影产量',
                        type: 'line',
                        data: counts,
                        areaStyle: {} // 区域填充样式
                    }
                ]
            };

            // 使用刚指定的配置项和数据显示图表
            myChart.setOption(option);
        }).catch(function(error) {
            console.error('Error loading or parsing data:', error);
        });
    </script>
</body>
</html>
